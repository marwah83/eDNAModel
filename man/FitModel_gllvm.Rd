% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/FitModel_gllvm.R
\name{FitModel_gllvm}
\alias{FitModel_gllvm}
\title{Fit a Multispecies Occupancy and Abundance Model Using GLLVM and GLMM}
\usage{
FitModel_gllvm(
  phyloseq,
  site_col,
  abundance_rhs,
  occupancy_covars = NULL,
  min_species_sum = 50,
  abundance_threshold = 1,
  n_iter = 50,
  burn_in = 10,
  abundance_family = "poisson"
)
}
\arguments{
\item{phyloseq}{A `phyloseq` object containing OTU table and sample metadata.}

\item{site_col}{Name of the column in `sample_data` indicating site ID.}

\item{abundance_rhs}{A one-sided formula specifying the right-hand side of the abundance model.}

\item{occupancy_covars}{Optional character vector of covariate names for the occupancy model.}

\item{min_species_sum}{Minimum number of reads for an OTU to be included.}

\item{abundance_threshold}{Threshold of reads to consider a species present (z = 1).}

\item{n_iter}{Number of iterations to simulate latent occupancy (`z_sim`).}

\item{burn_in}{Number of burn-in iterations to discard when summarizing posterior draws.}

\item{abundance_family}{Distribution family for abundance model. One of `"poisson"`, `"nbinom"`, `"zip"`, `"zinb"`.}
}
\value{
A list containing:
\describe{
  \item{summary}{Posterior summaries of occupancy (psi), abundance (lambda), and detection probability (p_detect)}
  \item{psi_list}{List of occupancy estimates per iteration}
  \item{lambda_list}{List of abundance estimates per iteration}
  \item{p_detect_list}{List of detection probabilities per iteration}
  \item{occupancy_models}{Fitted GLLVM occupancy models}
  \item{abundance_models}{Fitted GLMM abundance models}
  \item{reduced_data}{Processed input data}
  \item{lv_sites}{Latent variable coordinates of sites (per iteration)}
  \item{lv_species}{Latent variable coordinates of species (per iteration)}
  \item{mean_lv_sites}{Averaged site positions across iterations}
  \item{mean_lv_species}{Averaged species positions across iterations}
}
}
\description{
This function fits a hierarchical multispecies site occupancy and abundance model to
eDNA data stored in a `phyloseq` object. The occupancy component is modeled with a 
generalized latent variable model (GLLVM), and the abundance component is modeled 
using `glmmTMB`.
}
\details{
This function uses a **two-stage modeling approach**:

1. **Occupancy (`z`)** is estimated via a latent variable binomial model (`gllvm::gllvm`) using presence-absence data.
2. **Abundance (`y | z = 1`)** is modeled using `glmmTMB` with Poisson or negative binomial (and optional zero-inflation).

Each iteration updates simulated occupancy values (`z_sim`) based on predicted occupancy and detection.
Final summaries are computed after discarding `burn_in` iterations.
}
\examples{
\dontrun{
data("GlobalPatterns")
physeq <- subset_samples(GlobalPatterns, SampleType \%in\% c("Feces", "Mock"))
result <- FitModel_gllvm(
  phyloseq = physeq,
  site_col = "SampleType",
  abundance_rhs = (1 | OTU),
  occupancy_covars = c("SampleType"),
  abundance_family = "poisson",
  n_iter = 10,
  burn_in = 2
)
head(result$summary)
}
}
