---
title: "eDNAModel: Updated Workflow with Phyloseq"
author: "Marwah Soliman, Bert van der Veen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
    number_sections: true
vignette: >
  %\VignetteIndexEntry{eDNAModel: Updated Workflow with Phyloseq}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r load-packages, message=FALSE, warning=FALSE}
library(phyloseq)
library(Matrix)
library(eDNAModel)
library(dplyr)
library(tidyr)
library(ggplot2)
library(pheatmap)
library(tibble)
library(gllvm)
library(glmmTMB)
library(reshape2)
```

# 1. Introduction

This vignette demonstrates the updated occupancyâ€“detection model workflow using the `eDNAModel` package and `phyloseq` data objects. The workflow includes fitting binomial and Poisson mixed-effects models across iterations, visualizing occupancy and detection probabilities, using gllvm for occupancy model.

---

# 2. Load and Subset Data
```{r load-data}
physeq_new=readRDS("~/Downloads/BGE_Port_sampling.rds")
physeq_one=physeq_new$`Marine invasive species Thessaloniki`


out <- FitModel_gllvm(
       phyloseq = physeq_one,
       site_col = "Name",
       abundance_rhs = (1|Samplingmonth/OTU)+(1|OTU),
       occupancy_covars = "Samplingmonth",
       abundance_family = "poisson",
       n_iter = 50,
       burn_in = 10
   )

