% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Prepare_long_data.R
\name{prepare_long_data}
\alias{prepare_long_data}
\title{Prepare Long Format Data from a Phyloseq Object}
\usage{
prepare_long_data(
  physeq_obj,
  min_species_sum = 50,
  site_col,
  nested_cols = NULL
)
}
\arguments{
\item{physeq_obj}{A `phyloseq` object containing OTU (or ASV) abundance table and sample metadata.}

\item{min_species_sum}{Integer. Minimum total count threshold across all samples for a taxon to be retained. Default is 50.}

\item{site_col}{Character. Column name in `sample_data` representing the sampling site variable. This will be used to group data for site-level modeling.}

\item{nested_cols}{Optional character vector. Column names in `sample_data` to be combined into a nested grouping factor (`SampleRep`). Used for hierarchical or repeated measures design. Default is `NULL`.}
}
\value{
A list with two elements:
\describe{
  \item{physeq_filtered}{A filtered `phyloseq` object with low-abundance and low-prevalence taxa removed.}
  \item{long_df}{A long-format `data.frame` with OTU counts and merged metadata. Contains one row per `SampleRep Ã— OTU`. Columns include `SampleRep`, `OTU`, `y` (abundance), and all metadata variables.}
}
}
\description{
Converts a `phyloseq` object into a tidy long-format data frame for modeling, with options for filtering taxa and creating nested replicate groupings.
}
\details{
This function is designed to transform a `phyloseq` object into a format suitable for downstream generalized linear mixed modeling (GLMM). Key steps include:
\itemize{
  \item Taxa are filtered by total count (`min_species_sum`) and then by prevalence (present in more than 5 samples).
  \item A `SampleRep` variable is constructed from `nested_cols` if provided, otherwise defaults to sample names.
  \item The OTU table is melted into long format and joined with sample metadata using `SampleRep`.
  \item A new column `Site` is created using the `site_col`, for grouping and site-level modeling.
}

The resulting data frame (`long_df`) can be used for modeling occupancy and abundance in ecological or microbiome analyses, including two-part models like those implemented in `FitModel()`.
}
\examples{
\dontrun{
data(GlobalPatterns)
long_data <- prepare_long_data(GlobalPatterns, site_col = "SampleID", min_species_sum = 50)
}

}
\seealso{
\code{\link{FitModel}} for modeling based on this long-format data.
}
